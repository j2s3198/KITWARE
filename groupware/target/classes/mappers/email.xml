<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="project.groupware.email.Dao"> <!-- Dao implements한 클래스 이름지정 -->

	<resultMap id="emailResult" type="project.groupware.email.Email"> <!-- id:검색된결과를 반환, type:Bean/DTO/VO -->
		<result column="email_id" property="email_id" /> <!-- column:컬럼이름, property:멤버변수 -->
		<result column="email_title" property="email_title" />
		<result column="email_content" property="email_content" />
		<result column="email_file" property="email_file" />
		<result column="email_path" property="email_path" />		
		<result column="send_member_id" property="send_member_id" />
		<result column="receive_member_id" property="receive_member_id" />
		<result column="send_time" property="send_time" />
		<result column="email_status" property="email_status" />			
	</resultMap>

	<insert id="insert" parameterType="project.groupware.email.Email"> <!-- id:interface method 이름, parameterType:객체 -->
		INSERT INTO email VALUES(#{email_id}, #{email_title}, #{email_content}, #{email_file},	#{email_path})		
	</insert>
	
	<insert id="insert2" parameterType="project.groupware.email.Email"> <!-- id:interface method 이름, parameterType:객체 -->		
		INSERT INTO email_send VALUES(#{email_id}, #{send_member_id}, #{receive_member_id}, sysdate, 32)
	</insert>
	
	<select id="select" parameterType="int" resultMap="emailResult">
		SELECT * FROM email WHERE email_id = #{email_id}
	</select>
	
	<select id="selectSend" parameterType="int" resultMap="emailResult">
		SELECT * FROM email WHERE send_member_id = #{send_member_id} AND email_status IN (0,2,6,8,10)
	</select>
	
	<select id="selectReceive" parameterType="int" resultMap="emailResult">
		SELECT * FROM email WHERE receive_member_id = #{receive_member_id} AND email_status IN (0,1,4,5,9,32)
	</select>
	
	<select id="selectRecycle" parameterType="int" resultMap="emailResult">
		SELECT * FROM email WHERE (receive_member_id = #{send_member_id} AND email_status IN (2,3,6,7)) OR (send_member_id = #{send_member_id} AND email_status IN (1,3,9,11))
	</select>
	
	<delete id="updateSendDelete" parameterType="int">
		UPDATE email SET email_status = (email_status + 1) WHERE email_id = #{email_id}
	</delete>
	
	<delete id="updateSendRestore" parameterType="int">
		UPDATE email SET email_status = (email_status - 1) WHERE email_id = #{email_id}
	</delete>
	
	<delete id="updateReceiveDelete" parameterType="int">
		UPDATE email SET email_status = (email_status + 2) WHERE email_id = #{email_id}
	</delete>	
	
	<delete id="updateReceiveRestore" parameterType="int">
		UPDATE email SET email_status = (email_status - 2) WHERE email_id = #{email_id}
	</delete>
	
	<delete id="updateRecycleSend" parameterType="int">
		UPDATE email SET email_status = (email_status + 4) WHERE email_id = #{email_id}
	</delete>
	
	<delete id="updateRecycleReceive" parameterType="int">
		UPDATE email SET email_status = (email_status + 8) WHERE email_id = #{email_id}
	</delete>

</mapper>

