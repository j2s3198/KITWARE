package it.kit.gware.calendar;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import javax.annotation.Resource;
import javax.servlet.ServletRequest;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import dto.Calendar_Cate;
import dto.Calendar_Dto;

@Controller
public class Calendar_Controller {
	
	@Resource(name="Cal_Service")
	private Calendar_Service cal_Service;
	
	@RequestMapping(value = "/calendar",method=RequestMethod.GET)
	public ModelAndView calmain() {
		
		ModelAndView mav = new ModelAndView("/calendar/calendar");
		
		  ArrayList<Calendar_Cate> cateList = cal_Service.getCalCate();
		  
		  System.out.println(cateList);
		  
		  mav.addObject("cateList", cateList); 
		  
		  
		  HashMap<String, String> cateMap = new HashMap<String, String>();
		  for(Calendar_Cate cate : cateList) {
			  cateMap.put(String.valueOf(cate.getCal_cate_id()), cate.getCal_cate_name());
			  System.out.println(cateMap.get("6"));
		  }
		  
		  mav.addObject(cateMap);
		
		return mav;
	}
	
	@ResponseBody
	@RequestMapping(value="/calendar/addEvent", method=RequestMethod.POST)
	public int addCalendar(ServletRequest req, Calendar_Dto dto) {
		
		System.out.println(dto);
		
		int result = cal_Service.addCal(dto);
		
		System.out.println("result : "+result);
		
		return result;
	}
	
	@ResponseBody
	@RequestMapping(value="/calendar/getAll", method=RequestMethod.POST)
	public String getAllCal() {
		
		ArrayList<Calendar_Dto> calList = cal_Service.getAllCal();
		
		  JSONArray arr = new JSONArray();
		  for(Calendar_Dto dto : calList) {
			  JSONObject jobj = new JSONObject();
			  
			/*
			 * jobj.put("calendar_id", dto.getCalendar_id()); jobj.put("calendar_cate",
			 * dto.getCalendar_cate()); jobj.put("calendar_member_id",
			 * dto.getCalendar_member_id()); jobj.put("calendar_start",
			 * dto.getCalendar_start()); jobj.put("calendar_end", dto.getCalendar_end());
			 * jobj.put("calendar_title", dto.getCalendar_title());
			 * jobj.put("calendar_content", dto.getCalendar_content());
			 * jobj.put("calendar_color", dto.getCalendar_color());
			 */
			  jobj.put("calendar_id", dto.getCalendar_id());
			  jobj.put("calendar_cate", dto.getCalendar_cate());
			  jobj.put("calendar_member_id", dto.getCalendar_member_id());
			  jobj.put("start", dto.getCalendar_start());
			  jobj.put("end", dto.getCalendar_end());
			  jobj.put("title", dto.getCalendar_title());
			  jobj.put("content", dto.getCalendar_content());
			  jobj.put("color", dto.getCalendar_color());
			  
			  arr.add(jobj);
		  }
		
		return arr.toJSONString();
	}
	
	
	

}
