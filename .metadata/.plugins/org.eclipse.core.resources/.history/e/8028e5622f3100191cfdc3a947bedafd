<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>

	<link rel="stylesheet" type="text/css" href="${pageContext.request.contextPath}/resources/jquery-easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="${pageContext.request.contextPath}/resources/jquery-easyui/themes/icon.css">
    <!-- <link rel="stylesheet" type="text/css" href="/resources/jquery-easyui/demo.css"> -->
    <script type="text/javascript" src="${pageContext.request.contextPath}/resources/jquery-easyui/jquery.min.js"></script>
    <script type="text/javascript" src="${pageContext.request.contextPath}/resources/jquery-easyui/jquery.easyui.min.js"></script>

	<div class=" container">
	
	<div class="row">
	<h2>결재자 찾기</h2>
	</div>
	<div class="row">
	<div class="container col-4" style="padding: 3px">
    <div class="easyui-panel" style="padding:4px; ">
        <ul id="tt" class="easyui-tree">


<li><span>GROUP WARE</span>
							<ul>
								<c:forEach items="${deptList}" var="dept">
									<li data-options="state:'open'"><span>${dept.department_id}) ${dept.department_name}</span>
										<ul>
 											<c:forEach items="${memList}" var="mem">
												<c:if test="${dept.department_id eq mem.member_department}">
												<c:if test="${mem.rank_name == null}"> ${ mem.rank_name = "발령대기" }</c:if>
													<li>${mem.rank_name}|${mem.member_id}|${mem.member_name}</li> 
												</c:if>
											</c:forEach>
										</ul>
									</li>
								</c:forEach>
							</ul>
						</li>





        </ul>
    </div>
    </div>
    
    
    <div class="container col-4" style="border: 1px solid gray; padding: 5 10 5 20;">
    	
    	<div class="row">
    	<label>성명</label>
    	<input type="text" />
    	<button>검색</button>
    	</div>
    	
    	<div class="row">
    	
    	<table>
    	
    	<tr>
    	<th>부서</th>
    	<th>성명</th>
    	<th>직위</th>
    	<th>사번</th>
    	</tr>
    	
    	<tbody id="tbody">
      	<c:forEach var="item" items="${ memList }">
    	
    	<%-- <c:if test="${ item.department_name == null }">${ item.department_name = "발령대기" }</c:if> --%>
    	
	    	<tr onclick="">
	    	<td>
	    	<c:choose>
	    		<c:when test="${ item.department_name == null }">${ item.department_name = "발령대기" }</c:when>
	    		<c:otherwise>${ item.department_name }</c:otherwise>
	    	</c:choose>
	    	</td>
	    	<td>${ item.member_name }</td>
			<td>${ item.rank_name }</td>
			<td>${ item.member_id }</td>
    		</tr>
    	
    	</c:forEach>
    	</tbody>
    	</table>
    	
    	</div>
    
    </div>

    
    </div><!-- row  -->
    
    
    <script>
    
    $('#tt').tree({
    	onClick: function(node){
    		alert(node.text);  // alert node text property when clicked
    		
    		console.log(typeof(node.text))
    		
    		var arr = (node.text).split(')');
		    		
    		var param = "deptId="+arr[0];
    		 $.ajax({
                          type: 'POST',
                          url: "${ pageContext.request.contextPath }/approval/searchDept",
                          data: param,
                          success: function(data) {
            					console.log(data);
            					var obj = JSON.parse(data);
            					
            					$('#tbody').empty();
            					
            					for(var i in obj){
            						console.log(obj[i])
            						
	            					$('<tr></tr>').attr('id', obj[i].member_id).appendTo('#tbody');
	            					$('<td></td>').text(obj[i].department_name).appendTo('#'+obj[i].member_id+'');
	            					$('<td></td>').text(obj[i].member_name).appendTo('#'+obj[i].member_id+'');
	            					$('<td></td>').text(obj[i].rank_name).appendTo('#'+obj[i].member_id+'');
	            					$('<td></td>').text(obj[i].member_id).appendTo('#'+obj[i].member_id+'');
            						
            					}

            					return;
					},
					error: function(){
						return;
					}
			});
    		
    		
    		
/*     		$('<li></li>').text('test').appendTo('#_easyui_tree_1');
    		
    		console.log($('#pickList>li').size())  
    		
    		$('#pickList').find('li').each(function(i, e){
    			console.log($(this).text());
    			
    			if(node.text == $(this).text()){
    				console.log('이미추가')
    				return;
    			} 
    			
    			
    		
			});
    		
    		*/

    		
    	}
    });
    
    </script>
    
    


</body>
</html>